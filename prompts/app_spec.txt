<project_specification>
  <project_name>StorePro</project_name>

  <overview>
    StorePro is a SaaS platform that enables customers to build AI-assisted ecommerce stores, view comprehensive analytics dashboards, and manage their online businesses. The platform features a public marketing landing page, customer portal with store builder and analytics, and an admin panel for full platform control. Customers can deploy stores on subdomains (store.storepro.io) or connect custom domains, and accept payments via their own Stripe/PayPal accounts.
  </overview>

  <technology_stack>
    <frontend>
      <framework>Next.js 14 with App Router</framework>
      <language>TypeScript</language>
      <styling>Tailwind CSS + shadcn/ui</styling>
      <state_management>React Context + TanStack Query</state_management>
      <forms>React Hook Form + Zod validation</forms>
      <charts>Recharts for analytics visualizations</charts>
    </frontend>
    <backend>
      <runtime>Node.js</runtime>
      <framework>Next.js API Routes</framework>
      <database>PostgreSQL</database>
      <orm>Prisma</orm>
      <authentication>NextAuth.js (Auth.js)</authentication>
      <file_storage>AWS S3 / Cloudflare R2</file_storage>
      <payments>Stripe (platform billing + customer store payments)</payments>
      <ai>OpenAI API for store generation suggestions</ai>
    </backend>
    <infrastructure>
      <hosting>Vercel</hosting>
      <database_hosting>Vercel Postgres or Supabase</database_hosting>
      <cdn>Vercel Edge Network</cdn>
      <domains>Custom domain support via Vercel</domains>
    </infrastructure>
    <communication>
      <api>REST API with Next.js API Routes</api>
      <realtime>Server-Sent Events for live analytics updates</realtime>
    </communication>
  </technology_stack>

  <prerequisites>
    <environment_setup>
      - Node.js 18+ installed
      - PostgreSQL database (local or cloud)
      - Stripe account with API keys
      - OpenAI API key
      - AWS S3 or Cloudflare R2 bucket for file storage
      - Environment variables configured (.env.local)
    </environment_setup>
  </prerequisites>

  <security_and_access_control>
    <complexity_tier>Complex</complexity_tier>
    <test_count_target>400+</test_count_target>
    <user_roles>
      <role name="admin">
        <description>Platform administrators with full control</description>
        <permissions>
          - View all customers and their data
          - Edit any customer's dashboard or store
          - Manage platform subscriptions and billing
          - Send announcements/notifications to all users
          - Approve/reject stores before going live
          - Access admin analytics (platform-wide metrics)
          - Manage templates and AI configurations
          - View platform revenue and financial reports
          - Suspend or ban user accounts
          - Access all admin panel features
        </permissions>
        <protected_routes>
          - /admin/*
          - /api/admin/*
        </protected_routes>
      </role>
      <role name="customer">
        <description>Paying customers who build and manage stores</description>
        <permissions>
          - View own dashboard and analytics
          - Create and manage own ecommerce stores
          - Edit store products, pages, and settings
          - Connect custom domains
          - Configure payment providers (Stripe/PayPal)
          - View own sales and traffic data
          - Export own data
          - Manage account settings and billing
          - Access customer support
        </permissions>
        <protected_routes>
          - /dashboard/*
          - /store-builder/*
          - /settings/*
          - /api/customer/*
        </protected_routes>
      </role>
      <role name="visitor">
        <description>Unauthenticated users viewing public pages</description>
        <permissions>
          - View landing page
          - View pricing page
          - View public store pages (customer stores)
          - Register for an account
          - Contact support
        </permissions>
        <protected_routes>
          - / (landing page)
          - /pricing
          - /login
          - /register
          - /store/* (public customer stores)
        </protected_routes>
      </role>
    </user_roles>
    <authentication>
      <method>Email/password + OAuth (Google, GitHub)</method>
      <session_timeout>7 days with refresh tokens</session_timeout>
      <password_requirements>Minimum 8 characters, 1 uppercase, 1 number</password_requirements>
    </authentication>
    <sensitive_operations>
      - Delete account requires password confirmation
      - Store publish requires admin approval
      - Payment provider changes require email verification
      - Domain changes require DNS verification
      - Bulk data deletion requires confirmation modal
    </sensitive_operations>
  </security_and_access_control>

  <core_features>
    <landing_page>
      - Hero section with headline, subheadline, and CTA buttons
      - Feature benefits section with icons and descriptions
      - How it works / method section (step-by-step process)
      - Testimonials section with customer reviews and ratings
      - Pricing section with tiered packages
      - FAQ accordion section
      - Statistics bar (customers served, revenue generated, etc.)
      - Footer with navigation, legal links, and contact info
      - Responsive design for all screen sizes
      - SEO optimized with meta tags and structured data
      - Live chat widget integration
    </landing_page>

    <pricing_page>
      - Multiple pricing tiers with feature comparison
      - One-time payment model (Basic: $69, Standard: $399, Advanced: $799, Pro: $1399, Master: $2499)
      - Feature lists for each tier
      - Most popular badge on recommended tier
      - Custom package inquiry option
      - Testimonials specific to pricing
      - FAQ section for pricing questions
      - Secure checkout with Stripe integration
      - Payment confirmation and receipt emails
    </pricing_page>

    <authentication>
      - Email/password registration with email verification
      - OAuth login (Google, GitHub)
      - Login with remember me option
      - Password reset via email
      - Two-factor authentication (optional)
      - Session management (view active sessions, revoke)
      - Account lockout after failed attempts
      - Secure password hashing (bcrypt)
    </authentication>

    <customer_dashboard>
      - Overview cards (total sales, visitors, orders, conversion rate)
      - Revenue chart (daily/weekly/monthly/yearly)
      - Traffic chart (visitors over time)
      - Recent orders list
      - Top selling products
      - Sales by source/channel
      - Real-time visitor count
      - Quick action buttons (view store, add product, etc.)
      - Date range selector for all analytics
      - Export data to CSV/PDF
      - Customizable dashboard widgets
    </customer_dashboard>

    <analytics_module>
      - Sales analytics (revenue, AOV, order count, refunds)
      - Traffic analytics (visitors, page views, bounce rate, session duration)
      - Product performance (views, add to cart, purchases, conversion)
      - Customer analytics (new vs returning, geographic distribution)
      - Source/channel attribution (organic, paid, social, direct)
      - Conversion funnel visualization
      - Real-time analytics feed
      - Comparative metrics (vs previous period)
      - Goal tracking and KPIs
      - Heatmaps for page engagement (future)
    </analytics_module>

    <store_builder>
      - Template gallery with 5 starter templates (Fashion, Electronics, Food, Home Decor, General)
      - AI-powered store generation from text prompt
      - AI suggests designs based on industry/preferences
      - Drag-and-drop page builder
      - Visual editor for customizing templates
      - Product management (add, edit, delete products)
      - Category/collection management
      - Page management (home, about, contact, custom pages)
      - Navigation menu editor
      - Theme customization (colors, fonts, spacing)
      - Logo and branding upload
      - Mobile preview mode
      - SEO settings per page
      - Social media integration
      - Live preview of changes
    </store_builder>

    <product_management>
      - Add products with title, description, price, images
      - Multiple product images with gallery
      - Product variants (size, color, etc.)
      - Inventory tracking
      - SKU management
      - Product categories and tags
      - Bulk import/export products (CSV)
      - Product visibility (published, draft, archived)
      - SEO fields (meta title, description, URL slug)
      - Related products suggestions
      - Product reviews/ratings display
    </product_management>

    <store_settings>
      - General settings (store name, description, contact email)
      - Domain management (subdomain + custom domain)
      - DNS verification for custom domains
      - SSL certificate provisioning
      - Currency and locale settings
      - Tax configuration
      - Shipping zones and rates
      - Payment provider connection (Stripe, PayPal)
      - Checkout customization
      - Order notification emails
      - Legal pages (privacy policy, terms, refund policy)
    </store_settings>

    <customer_store_frontend>
      - Responsive storefront design
      - Product listing page with filters and sorting
      - Product detail page with gallery, variants, add to cart
      - Shopping cart with quantity adjustment
      - Checkout flow (shipping, payment, confirmation)
      - Order confirmation page and email
      - Customer account (order history, addresses, settings)
      - Search functionality
      - Wishlist/favorites
      - Related products recommendations
    </customer_store_frontend>

    <order_management>
      - Order list with status filters
      - Order detail view (items, customer, shipping, payment)
      - Order status updates (pending, processing, shipped, delivered)
      - Fulfillment tracking
      - Refund processing
      - Order notes and history
      - Print packing slips/invoices
      - Bulk order actions
      - Order notifications to customer
    </order_management>

    <customer_settings>
      - Profile management (name, email, avatar)
      - Password change
      - Two-factor authentication setup
      - Notification preferences
      - Billing history
      - Current subscription/package info
      - Connected payment accounts
      - API keys for integrations
      - Data export (GDPR compliance)
      - Account deletion
    </customer_settings>

    <admin_panel>
      - Admin dashboard with platform-wide metrics
      - Customer management (list, search, filter, view details)
      - View/edit any customer's dashboard
      - View/edit any customer's store
      - Store approval queue (pending, approved, rejected)
      - Subscription/billing management
      - Revenue reports (platform fees, MRR, churn)
      - Announcement system (send to all or segments)
      - Template management (add, edit, delete templates)
      - AI configuration settings
      - Platform settings (pricing, features, limits)
      - User impersonation for support
      - Audit logs (all admin actions)
      - System health monitoring
    </admin_panel>

    <notifications>
      - In-app notification center
      - Email notifications (orders, announcements, etc.)
      - Push notifications (optional)
      - Admin announcement broadcasts
      - Order status update notifications
      - Security alerts (new login, password change)
      - Notification preferences management
    </notifications>

    <support>
      - Help center / documentation
      - Contact form
      - Live chat widget
      - Support ticket system (future)
      - FAQ search
    </support>
  </core_features>

  <database_schema>
    <tables>
      <users>
        - id (uuid, primary key)
        - email (unique, not null)
        - password_hash (nullable for OAuth users)
        - name (not null)
        - avatar_url (nullable)
        - role (enum: admin, customer)
        - email_verified (boolean)
        - two_factor_enabled (boolean)
        - two_factor_secret (nullable)
        - created_at, updated_at
      </users>

      <accounts>
        - id, user_id (foreign key)
        - provider, provider_account_id
        - access_token, refresh_token, expires_at
        - OAuth account linking for NextAuth
      </accounts>

      <sessions>
        - id, user_id (foreign key)
        - session_token (unique)
        - expires_at
        - ip_address, user_agent
      </sessions>

      <subscriptions>
        - id, user_id (foreign key)
        - package (enum: basic, standard, advanced, pro, master)
        - stripe_payment_id
        - amount, currency
        - status (enum: active, cancelled, expired)
        - purchased_at, expires_at
      </subscriptions>

      <stores>
        - id (uuid, primary key)
        - user_id (foreign key)
        - name, slug (unique)
        - description
        - logo_url, favicon_url
        - template_id (foreign key)
        - theme_settings (jsonb: colors, fonts, etc.)
        - custom_domain (nullable, unique)
        - domain_verified (boolean)
        - status (enum: draft, pending_approval, approved, suspended)
        - currency, locale, timezone
        - created_at, updated_at
      </stores>

      <store_pages>
        - id, store_id (foreign key)
        - title, slug, type (home, about, contact, product, custom)
        - content (jsonb: page builder blocks)
        - seo_title, seo_description
        - is_published (boolean)
        - sort_order
        - created_at, updated_at
      </store_pages>

      <products>
        - id, store_id (foreign key)
        - title, description, slug
        - price, compare_at_price
        - sku, barcode
        - inventory_quantity, track_inventory (boolean)
        - status (enum: active, draft, archived)
        - category_id (foreign key, nullable)
        - seo_title, seo_description
        - created_at, updated_at
      </products>

      <product_images>
        - id, product_id (foreign key)
        - url, alt_text
        - sort_order, is_primary (boolean)
      </product_images>

      <product_variants>
        - id, product_id (foreign key)
        - title (e.g., "Large / Red")
        - sku, price, inventory_quantity
        - option_values (jsonb: {size: "Large", color: "Red"})
      </product_variants>

      <categories>
        - id, store_id (foreign key)
        - name, slug, description
        - parent_id (self-referential, nullable)
        - image_url, sort_order
      </categories>

      <orders>
        - id, store_id (foreign key)
        - order_number (unique per store)
        - customer_email, customer_name
        - shipping_address (jsonb)
        - billing_address (jsonb)
        - subtotal, tax, shipping_cost, total
        - currency
        - status (enum: pending, processing, shipped, delivered, cancelled, refunded)
        - payment_status (enum: pending, paid, failed, refunded)
        - payment_provider, payment_id
        - notes
        - created_at, updated_at
      </orders>

      <order_items>
        - id, order_id (foreign key)
        - product_id, variant_id (nullable)
        - title, sku
        - quantity, unit_price, total
      </order_items>

      <store_customers>
        - id, store_id (foreign key)
        - email, name
        - password_hash (nullable for guest checkout)
        - addresses (jsonb array)
        - total_orders, total_spent
        - created_at, updated_at
      </store_customers>

      <analytics_events>
        - id, store_id (foreign key)
        - event_type (page_view, add_to_cart, purchase, etc.)
        - visitor_id, session_id
        - page_url, referrer
        - product_id (nullable)
        - metadata (jsonb)
        - created_at
      </analytics_events>

      <templates>
        - id, name, slug
        - description, thumbnail_url
        - category (fashion, electronics, food, etc.)
        - default_theme (jsonb)
        - default_pages (jsonb)
        - is_active (boolean)
        - created_at, updated_at
      </templates>

      <announcements>
        - id, admin_id (foreign key)
        - title, content
        - target (all, segment)
        - target_segment (jsonb, nullable)
        - is_published (boolean)
        - published_at
        - created_at
      </announcements>

      <notifications>
        - id, user_id (foreign key)
        - type (order, announcement, security, etc.)
        - title, message
        - data (jsonb)
        - is_read (boolean)
        - created_at
      </notifications>

      <payment_providers>
        - id, store_id (foreign key)
        - provider (stripe, paypal)
        - is_active (boolean)
        - credentials (encrypted jsonb)
        - created_at, updated_at
      </payment_providers>

      <audit_logs>
        - id, admin_id (foreign key)
        - action, entity_type, entity_id
        - details (jsonb)
        - ip_address
        - created_at
      </audit_logs>
    </tables>
  </database_schema>

  <api_endpoints_summary>
    <auth>
      - POST /api/auth/register
      - POST /api/auth/login
      - POST /api/auth/logout
      - POST /api/auth/forgot-password
      - POST /api/auth/reset-password
      - POST /api/auth/verify-email
      - GET /api/auth/session
      - NextAuth.js handles OAuth routes
    </auth>

    <customer>
      - GET /api/customer/dashboard (analytics overview)
      - GET /api/customer/analytics (detailed analytics)
      - GET /api/customer/profile
      - PUT /api/customer/profile
      - PUT /api/customer/password
      - GET /api/customer/notifications
      - PUT /api/customer/notifications/:id/read
      - GET /api/customer/subscription
    </customer>

    <stores>
      - GET /api/stores (list user's stores)
      - POST /api/stores (create store)
      - GET /api/stores/:id
      - PUT /api/stores/:id
      - DELETE /api/stores/:id
      - POST /api/stores/:id/publish (submit for approval)
      - POST /api/stores/:id/verify-domain
    </stores>

    <pages>
      - GET /api/stores/:storeId/pages
      - POST /api/stores/:storeId/pages
      - GET /api/stores/:storeId/pages/:id
      - PUT /api/stores/:storeId/pages/:id
      - DELETE /api/stores/:storeId/pages/:id
    </pages>

    <products>
      - GET /api/stores/:storeId/products
      - POST /api/stores/:storeId/products
      - GET /api/stores/:storeId/products/:id
      - PUT /api/stores/:storeId/products/:id
      - DELETE /api/stores/:storeId/products/:id
      - POST /api/stores/:storeId/products/import
      - GET /api/stores/:storeId/products/export
    </products>

    <categories>
      - GET /api/stores/:storeId/categories
      - POST /api/stores/:storeId/categories
      - PUT /api/stores/:storeId/categories/:id
      - DELETE /api/stores/:storeId/categories/:id
    </categories>

    <orders>
      - GET /api/stores/:storeId/orders
      - GET /api/stores/:storeId/orders/:id
      - PUT /api/stores/:storeId/orders/:id (update status)
      - POST /api/stores/:storeId/orders/:id/refund
    </orders>

    <templates>
      - GET /api/templates
      - GET /api/templates/:id
    </templates>

    <ai>
      - POST /api/ai/generate-store (AI store suggestions)
      - POST /api/ai/generate-content (AI content generation)
    </ai>

    <admin>
      - GET /api/admin/dashboard (platform metrics)
      - GET /api/admin/customers
      - GET /api/admin/customers/:id
      - PUT /api/admin/customers/:id
      - DELETE /api/admin/customers/:id (suspend)
      - GET /api/admin/stores
      - GET /api/admin/stores/:id
      - PUT /api/admin/stores/:id/approve
      - PUT /api/admin/stores/:id/reject
      - GET /api/admin/subscriptions
      - POST /api/admin/announcements
      - GET /api/admin/audit-logs
      - GET /api/admin/templates
      - POST /api/admin/templates
      - PUT /api/admin/templates/:id
      - DELETE /api/admin/templates/:id
    </admin>

    <storefront>
      - GET /api/storefront/:slug (public store data)
      - GET /api/storefront/:slug/products
      - GET /api/storefront/:slug/products/:id
      - POST /api/storefront/:slug/cart
      - POST /api/storefront/:slug/checkout
      - POST /api/storefront/:slug/analytics (track events)
    </storefront>

    <payments>
      - POST /api/payments/checkout (platform subscription)
      - POST /api/payments/webhook (Stripe webhook)
      - POST /api/stores/:storeId/payments/connect (connect Stripe)
    </payments>

    <uploads>
      - POST /api/uploads/image
      - DELETE /api/uploads/image/:key
    </uploads>
  </api_endpoints_summary>

  <ui_layout>
    <main_structure>
      Landing page and public store pages are full-width single column.
      Dashboard and admin panel use a sidebar navigation layout with main content area.
      Store builder uses a left panel (tools) + center canvas + right panel (properties) layout.
    </main_structure>

    <landing_page_layout>
      - Fixed header with logo, nav links, and CTA button
      - Full-width hero section
      - Alternating content sections
      - Pricing cards grid
      - Full-width CTA section
      - Footer with multiple columns
    </landing_page_layout>

    <dashboard_layout>
      - Collapsible sidebar (260px) with navigation
      - Top header with search, notifications, user menu
      - Main content area with breadcrumbs
      - Responsive: sidebar becomes mobile drawer on small screens
    </dashboard_layout>

    <store_builder_layout>
      - Top toolbar with save, preview, publish buttons
      - Left sidebar (240px) with components/blocks
      - Center canvas (flexible) with live preview
      - Right sidebar (300px) with properties panel
      - Bottom bar with device preview toggles
    </store_builder_layout>

    <admin_panel_layout>
      - Similar to dashboard but with admin-specific navigation
      - Data tables with filters, search, bulk actions
      - Detail views with edit capabilities
      - Modals for quick actions
    </admin_panel_layout>
  </ui_layout>

  <design_system>
    <color_palette>
      - Primary: #2563eb (blue-600) - main actions, links
      - Secondary: #7c3aed (violet-600) - accents
      - Success: #16a34a (green-600)
      - Warning: #ca8a04 (yellow-600)
      - Error: #dc2626 (red-600)
      - Neutral: slate scale (50-950)
      - Background: white (#ffffff) / slate-50
      - Dark mode support with inverted palette
    </color_palette>

    <typography>
      - Font family: Inter (sans-serif)
      - Headings: bold weight, tight letter-spacing
      - Body: regular weight, relaxed line-height
      - Mono: JetBrains Mono for code/data
      - Scale: text-xs through text-4xl
    </typography>

    <components>
      - shadcn/ui component library
      - Consistent border radius (rounded-lg default)
      - Subtle shadows for elevation
      - Focus rings for accessibility
      - Smooth transitions (150ms ease)
    </components>

    <icons>
      - Lucide React icon library
      - Consistent 20px/24px sizing
      - Stroke width 1.5-2
    </icons>
  </design_system>

  <implementation_steps>
    <step number="1">
      <title>Project Setup and Infrastructure</title>
      <tasks>
        - Initialize Next.js 14 project with TypeScript
        - Configure Tailwind CSS and shadcn/ui
        - Set up Prisma with PostgreSQL
        - Configure NextAuth.js with providers
        - Set up environment variables
        - Create basic folder structure
        - Set up ESLint and Prettier
      </tasks>
    </step>

    <step number="2">
      <title>Database and Authentication</title>
      <tasks>
        - Create Prisma schema with all models
        - Run migrations
        - Implement user registration and login
        - Implement OAuth providers
        - Create auth middleware
        - Implement role-based access control
        - Email verification flow
        - Password reset flow
      </tasks>
    </step>

    <step number="3">
      <title>Landing Page and Marketing</title>
      <tasks>
        - Build landing page with all sections
        - Build pricing page
        - Implement Stripe checkout for subscriptions
        - Create legal pages (privacy, terms)
        - SEO optimization
        - Responsive design testing
      </tasks>
    </step>

    <step number="4">
      <title>Customer Dashboard</title>
      <tasks>
        - Dashboard layout with sidebar navigation
        - Analytics overview cards
        - Revenue and traffic charts
        - Recent orders list
        - Date range selector
        - Export functionality
      </tasks>
    </step>

    <step number="5">
      <title>Store Builder - Core</title>
      <tasks>
        - Template gallery and selection
        - Store creation flow
        - Basic page editor
        - Theme customization panel
        - Logo and branding upload
        - Preview mode
      </tasks>
    </step>

    <step number="6">
      <title>Store Builder - Products</title>
      <tasks>
        - Product CRUD operations
        - Image upload and gallery
        - Variants and inventory
        - Categories management
        - Bulk import/export
      </tasks>
    </step>

    <step number="7">
      <title>Store Builder - Advanced</title>
      <tasks>
        - Drag-and-drop page builder
        - AI store generation
        - Navigation menu editor
        - SEO settings
        - Domain management
      </tasks>
    </step>

    <step number="8">
      <title>Customer Storefront</title>
      <tasks>
        - Dynamic storefront rendering
        - Product listing with filters
        - Product detail page
        - Shopping cart
        - Checkout flow
        - Order confirmation
      </tasks>
    </step>

    <step number="9">
      <title>Order Management</title>
      <tasks>
        - Order listing and detail views
        - Status management
        - Refund processing
        - Order notifications
        - Customer management
      </tasks>
    </step>

    <step number="10">
      <title>Payment Integration</title>
      <tasks>
        - Stripe Connect for customer stores
        - PayPal integration
        - Payment webhooks
        - Payout management
      </tasks>
    </step>

    <step number="11">
      <title>Analytics System</title>
      <tasks>
        - Event tracking implementation
        - Analytics data aggregation
        - Dashboard visualizations
        - Real-time updates
        - Goal tracking
      </tasks>
    </step>

    <step number="12">
      <title>Admin Panel</title>
      <tasks>
        - Admin dashboard
        - Customer management
        - Store approval workflow
        - Announcement system
        - Template management
        - Audit logs
      </tasks>
    </step>

    <step number="13">
      <title>Notifications and Support</title>
      <tasks>
        - Notification system
        - Email notifications
        - Help center
        - Contact forms
        - Live chat integration
      </tasks>
    </step>

    <step number="14">
      <title>Polish and Optimization</title>
      <tasks>
        - Performance optimization
        - Accessibility audit
        - Security hardening
        - Error handling
        - Loading states
        - Empty states
        - Documentation
      </tasks>
    </step>
  </implementation_steps>

  <success_criteria>
    <functionality>
      - All CRUD operations work correctly
      - Authentication flows complete without errors
      - Payments process successfully
      - Analytics display accurate real-time data
      - Store builder creates functional stores
      - Customer stores accept orders
      - Admin can manage entire platform
    </functionality>

    <user_experience>
      - Pages load in under 3 seconds
      - Intuitive navigation without documentation
      - Clear feedback for all actions
      - Mobile-responsive on all pages
      - No dead-end states or confusing errors
    </user_experience>

    <technical_quality>
      - No TypeScript errors
      - All API routes handle errors gracefully
      - Database queries are optimized
      - Security best practices followed
      - Code is maintainable and documented
    </technical_quality>

    <design_polish>
      - Consistent visual design throughout
      - Proper spacing and alignment
      - Professional typography
      - Smooth transitions and animations
      - Dark mode support (optional)
    </design_polish>
  </success_criteria>
</project_specification>
